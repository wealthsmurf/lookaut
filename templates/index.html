<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title id="site-title">ë¸”ë¡ ë°©ì–´ - ì˜¨ë¼ì¸ ë°˜ì‘ì†ë„ í…ŒìŠ¤íŠ¸ ê²Œì„</title>
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0000000000000000" crossorigin="anonymous"></script>

    <style>
        :root { --main-bg: #f4f4f4; --primary: #333; --accent: #007bff; --danger: #ff4d4d; }
        body { 
            margin: 0; background: var(--main-bg); font-family: 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif; 
            color: #333; display: flex; flex-direction: column; align-items: center; min-height: 100vh;
        }
        
        /* í—¤ë” & ì–¸ì–´ì„¤ì • */
        header { background: #fff; border-bottom: 1px solid #ddd; padding: 15px 0; text-align: center; width: 100%; position: relative; }
        #lang-toggle { position: absolute; top: 15px; right: 15px; padding: 5px 10px; border: 1px solid #ccc; border-radius: 5px; background: #fff; cursor: pointer; font-size: 12px; font-weight: bold; }

        #game-container { position: relative; padding: 20px 0; display: flex; flex-direction: column; align-items: center; width: 100%; }

        /* ê²Œì„ ì˜ì—­ */
        #game-wrapper { position: relative; margin-bottom: 20px; touch-action: manipulation; }
        canvas { 
            background: #ffffff; border: 4px solid var(--primary); 
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            width: 85vw; max-width: 360px; height: auto; display: block; border-radius: 12px;
        }

        /* UI */
        #ui-panel {
            position: absolute; top: 10px; width: 90%; left: 5%;
            display: flex; justify-content: space-between; align-items: center;
            pointer-events: none; z-index: 10;
        }
        .info-box { background: rgba(255,255,255,0.9); padding: 5px 10px; border: 2px solid var(--primary); border-radius: 8px; font-weight: bold; font-size: 13px; pointer-events: auto; }
        #mute-btn { background: var(--primary); color: white; border: none; padding: 5px 10px; border-radius: 8px; cursor: pointer; font-size: 11px; }

        /* íŒ¨ë„ ê³µí†µ */
        .panel { 
            display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            background: white; padding: 25px; border-radius: 20px; border: 3px solid var(--primary); 
            z-index: 100; text-align: center; width: 80%; max-width: 280px; box-shadow: 0 0 50px rgba(0,0,0,0.3); 
        }
        button.main-btn { padding: 12px 24px; background: var(--primary); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 16px; margin-top: 10px; }

        /* í•˜ë‹¨ ê´‘ê³  ì˜ì—­ */
        .bottom-ad { width: 100%; max-width: 360px; height: 60px; background: #eee; margin: 10px 0; display: flex; align-items: center; justify-content: center; overflow: hidden; }

        /* SEO ì½˜í…ì¸  ì„¹ì…˜ */
        .content-section { width: 90%; max-width: 600px; background: #fff; padding: 25px; margin: 20px 0 80px 0; border-radius: 15px; line-height: 1.7; font-size: 14px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .content-section h2 { border-left: 5px solid var(--accent); padding-left: 10px; font-size: 18px; margin-bottom: 15px; }

        footer { padding: 20px; font-size: 12px; color: #888; text-align: center; border-top: 1px solid #ddd; width: 100%; background: #fff; }
    </style>
</head>
<body>

<header>
    <h1 id="txt-header-title" style="margin:0; font-size: 20px;">ğŸ›¡ï¸ BLOCK DEFENSE</h1>
    <button id="lang-toggle" onclick="toggleLang()">KO / EN</button>
</header>

<div id="game-container">
    <div id="game-wrapper">
        <div id="ui-panel">
            <div id="time-display" class="info-box">0.0s</div>
            <div id="best-display" class="info-box" style="color: var(--accent);">Best: 0.0s</div>
            <button id="mute-btn" onclick="toggleMute(event)">ğŸµ On</button>
        </div>
        
        <canvas id="gameCanvas"></canvas>

        <div id="start-overlay" class="panel" style="display: flex; flex-direction: column;">
            <h2 id="txt-start-title">ê²Œì„ ì‹œì‘</h2>
            <p id="txt-start-desc" style="font-size: 13px; text-align: left; color: #555;">
                1. í•˜ì–€ ì ë°•ì´ ë¸”ë¡ì„ í´ë¦­í•´ íŒŒê´´í•˜ì„¸ìš”!<br>
                2. ê²€ì€ ê´‘ê³  ë¸”ë¡ì€ ì†ë„ë¥¼ ë‚®ì¶°ì¤ë‹ˆë‹¤.<br>
                3. í•˜ì–€ ë¸”ë¡ì´ ë°”ë‹¥ì— ë‹¿ìœ¼ë©´ ì¢…ë£Œë©ë‹ˆë‹¤.
            </p>
            <button class="main-btn" id="txt-start-btn" onclick="startGame()">START</button>
        </div>

        <div id="ad-modal" class="panel">
            <h3 id="txt-pause-title">ì ì‹œ íœ´ì‹</h3>
            <div id="kakao-ad-container" style="background:#f9f9f9; min-height:60px; margin-bottom:15px; border-radius:10px; display:flex; align-items:center; justify-content:center;">
                </div>
            <button class="main-btn" id="txt-pause-btn" onclick="closeAd()">ê³„ì†í•˜ê¸°</button>
        </div>

        <div id="game-over-panel" class="panel">
            <h2 id="txt-gameover-title" style="color: var(--danger);">GAME OVER</h2>
            <div id="final-time-val" style="font-size: 32px; font-weight: bold; margin-bottom: 15px;">0.0s</div>
            <button class="main-btn" id="txt-restart-btn" onclick="location.reload()">RETRY</button>
        </div>
    </div>

    <div class="bottom-ad">
        <ins class="kakao_ad_area" style="display:none;"
            data-ad-unit = "DAN-8OJpo4T0Kc2rPuXZ"
            data-ad-width = "320"
            data-ad-height = "50"></ins>
        <script type="text/javascript" src="//t1.daumcdn.net/kas/static/ba.min.js" async></script>
    </div>

    <section class="content-section">
        <h2 id="txt-content-h2">ë¸”ë¡ ë°©ì–´: ë°˜ì‘ì†ë„ í…ŒìŠ¤íŠ¸ ë° í›ˆë ¨</h2>
        <p id="txt-content-p1"><b>ë¸”ë¡ ë°©ì–´(Block Defense)</b>ëŠ” ì‚¬ìš©ìì˜ ë™ì  ì‹œë ¥ê³¼ í´ë¦­ ì •í™•ë„ë¥¼ ì¸¡ì •í•˜ê¸° ìœ„í•´ ì„¤ê³„ëœ ì›¹ ê¸°ë°˜ ì•„ì¼€ì´ë“œ ê²Œì„ì…ë‹ˆë‹¤. ë‹¨ìˆœí•˜ì§€ë§Œ ì¤‘ë…ì„± ìˆëŠ” ë©”ì»¤ë‹ˆì¦˜ì„ í†µí•´ ì§‘ì¤‘ë ¥ì„ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        
        <h3 id="txt-content-h3" style="font-size:16px;">ê²Œì„ ì „ëµ ë° íŠ¹ì§•</h3>
        <p id="txt-content-p2">í”Œë ˆì´ì–´ëŠ” ìœ„ì—ì„œ ë–¨ì–´ì§€ëŠ” ë‹¤ì–‘í•œ ë¸”ë¡ ì¤‘ ìœ„í—˜ ìš”ì†Œ(í°ìƒ‰ ë¸”ë¡)ë¥¼ ì‹ë³„í•˜ì—¬ ë¹ ë¥´ê²Œ ì œê±°í•´ì•¼ í•©ë‹ˆë‹¤. íŠ¹íˆ ê²€ì€ìƒ‰ ê´‘ê³  ë¸”ë¡ì€ ê²Œì„ì˜ í˜ì´ìŠ¤ë¥¼ ì¡°ì ˆí•˜ëŠ” ì¤‘ìš”í•œ ì „ëµì  ìš”ì†Œì…ë‹ˆë‹¤.</p>
    </section>
</div>

<footer>
    <p>Â© 2026 Block Defense Online. All rights reserved.</p>
    <div style="margin-top:10px;">
        <a href="#" style="color:#999; text-decoration:none;">Privacy Policy</a> | 
        <a href="#" style="color:#999; text-decoration:none;">Terms of Service</a>
    </div>
</footer>

<script>
    // --- ì–¸ì–´ ë°ì´í„° ---
    const i18n = {
        ko: {
            title: "ë¸”ë¡ ë°©ì–´ - ì˜¨ë¼ì¸ ë°˜ì‘ì†ë„ í…ŒìŠ¤íŠ¸ ê²Œì„",
            headerTitle: "ğŸ›¡ï¸ BLOCK DEFENSE",
            startTitle: "ê²Œì„ ì‹œì‘",
            startDesc: "1. í•˜ì–€ ì ë°•ì´ ë¸”ë¡ì„ í´ë¦­í•´ íŒŒê´´í•˜ì„¸ìš”!<br>2. ê²€ì€ ê´‘ê³  ë¸”ë¡ì€ ì†ë„ë¥¼ ë‚®ì¶°ì¤ë‹ˆë‹¤.<br>3. í•˜ì–€ ë¸”ë¡ì´ ë°”ë‹¥ì— ë‹¿ìœ¼ë©´ ì¢…ë£Œë©ë‹ˆë‹¤.",
            startBtn: "ë°©ì–´ ì‹œì‘",
            pauseTitle: "ì ì‹œ íœ´ì‹!",
            pauseBtn: "ê´‘ê³  ë‹«ê³  ê³„ì†í•˜ê¸°",
            gameoverTitle: "ê²Œì„ ì¢…ë£Œ",
            restartBtn: "ë‹¤ì‹œ ë„ì „",
            contentH2: "ë¸”ë¡ ë°©ì–´: ë°˜ì‘ì†ë„ í…ŒìŠ¤íŠ¸ ë° í›ˆë ¨",
            contentP1: "<b>ë¸”ë¡ ë°©ì–´(Block Defense)</b>ëŠ” ì‚¬ìš©ìì˜ ë™ì  ì‹œë ¥ê³¼ í´ë¦­ ì •í™•ë„ë¥¼ ì¸¡ì •í•˜ê¸° ìœ„í•´ ì„¤ê³„ëœ ì›¹ ê¸°ë°˜ ì•„ì¼€ì´ë“œ ê²Œì„ì…ë‹ˆë‹¤.",
            contentH3: "ê²Œì„ ì „ëµ ë° íŠ¹ì§•",
            contentP2: "ìœ„í—˜ ìš”ì†Œ(í°ìƒ‰ ë¸”ë¡)ë¥¼ ì‹ë³„í•˜ì—¬ ë¹ ë¥´ê²Œ ì œê±°í•´ì•¼ í•©ë‹ˆë‹¤. ê²€ì€ìƒ‰ ë¸”ë¡ì€ ì†ë„ë¥¼ ëŠ¦ì¶”ëŠ” ì „ëµì  ì•„ì´í…œì…ë‹ˆë‹¤."
        },
        en: {
            title: "Block Defense - Online Reaction Test",
            headerTitle: "ğŸ›¡ï¸ BLOCK DEFENSE",
            startTitle: "START GAME",
            startDesc: "1. Click white dotted blocks to destroy.<br>2. Black ad blocks will slow down the speed.<br>3. Game over if white blocks touch the bottom.",
            startBtn: "Start Defense",
            pauseTitle: "PAUSED",
            pauseBtn: "Close Ad & Continue",
            gameoverTitle: "GAME OVER",
            restartBtn: "Try Again",
            contentH2: "Block Defense: Reaction Training",
            contentP1: "<b>Block Defense</b> is a web arcade game designed to measure dynamic visual acuity and click accuracy.",
            contentH3: "Strategy & Features",
            contentP2: "Identify and remove threats (white blocks) quickly. Black blocks are strategic items that slow down falling speed."
        }
    };

    let currentLang = localStorage.getItem('gameLang') || 'ko';

    function updateLanguage() {
        const lang = i18n[currentLang];
        document.getElementById('site-title').innerText = lang.title;
        document.getElementById('txt-header-title').innerText = lang.headerTitle;
        document.getElementById('txt-start-title').innerText = lang.startTitle;
        document.getElementById('txt-start-desc').innerHTML = lang.startDesc;
        document.getElementById('txt-start-btn').innerText = lang.startBtn;
        document.getElementById('txt-pause-title').innerText = lang.pauseTitle;
        document.getElementById('txt-pause-btn').innerText = lang.pauseBtn;
        document.getElementById('txt-gameover-title').innerText = lang.gameoverTitle;
        document.getElementById('txt-restart-btn').innerText = lang.restartBtn;
        document.getElementById('txt-content-h2').innerText = lang.contentH2;
        document.getElementById('txt-content-p1').innerHTML = lang.contentP1;
        document.getElementById('txt-content-h3').innerText = lang.contentH3;
        document.getElementById('txt-content-p2').innerText = lang.contentP2;
    }

    function toggleLang() {
        currentLang = (currentLang === 'ko') ? 'en' : 'ko';
        localStorage.setItem('gameLang', currentLang);
        updateLanguage();
    }

    // --- ê²Œì„ ë¡œì§ ---
    const bgm = new Audio('Bgggm.mp3'); 
    bgm.loop = true;
    let isMuted = localStorage.getItem('gameMuted') === 'true';
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function playSfx(type) {
        if (isMuted || !gameActive) return;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        const now = audioCtx.currentTime;
        if (type === 'white') { osc.frequency.setValueAtTime(800, now); gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1); } 
        else if (type === 'black') { osc.frequency.setValueAtTime(400, now); gain.gain.exponentialRampToValueAtTime(0.01, now + 0.15); }
        else if (type === 'fail') { osc.frequency.setValueAtTime(200, now); gain.gain.linearRampToValueAtTime(0, now + 0.5); }
        osc.start(); osc.stop(now + 0.5);
    }

    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = 400; canvas.height = 650;
    const groundY = canvas.height - 60; 

    let blocks = [], particles = [], gameActive = false, isPaused = false, isGameOver = false;
    let moveSpeed = 2.3, startTime = 0, pausedTimeTotal = 0, pauseStartedAt = 0;
    let bestTime = localStorage.getItem('bestSurvivalTime') || 0;
    document.getElementById('best-display').innerText = `Best: ${parseFloat(bestTime).toFixed(1)}s`;

    class Particle {
        constructor(x, y, color) { this.x = x; this.y = y; this.color = color; this.size = Math.random() * 3 + 2; this.speedX = (Math.random() - 0.5) * 6; this.speedY = (Math.random() - 0.5) * 6 - 2; this.gravity = 0.15; this.life = 1.0; }
        update() { this.x += this.speedX; this.y += this.speedY; this.speedY += this.gravity; this.life -= 0.02; }
        draw() { ctx.save(); ctx.globalAlpha = this.life; ctx.fillStyle = this.color; ctx.fillRect(this.x, this.y, this.size, this.size); ctx.restore(); }
    }

    class Block {
        constructor(type, speed) { this.width = 60; this.height = 50; this.x = Math.random() * (canvas.width - this.width); this.y = -60; this.type = type; this.speed = speed; }
        draw() {
            ctx.save();
            ctx.fillStyle = (this.type === 'white' || this.type === 'whiteDot') ? '#FFFFFF' : '#000000';
            ctx.fillRect(this.x, this.y, this.width, this.height);
            ctx.strokeStyle = '#333'; ctx.lineWidth = 2; ctx.strokeRect(this.x, this.y, this.width, this.height);
            ctx.fillStyle = (this.type === 'white' || this.type === 'whiteDot') ? '#333' : '#FFFFFF';
            if (this.type === 'whiteDot') { ctx.beginPath(); ctx.arc(this.x + 30, this.y + 25, 4, 0, Math.PI*2); ctx.fill(); }
            else { [[15, 15], [45, 20], [20, 35], [40, 40]].forEach(p => { ctx.beginPath(); ctx.arc(this.x+p[0], this.y+p[1], 3, 0, Math.PI*2); ctx.fill(); }); }
            if(this.type === 'black') { ctx.font = 'bold 14px sans-serif'; ctx.textAlign = 'center'; ctx.fillText(currentLang === 'ko' ? "ê´‘ê³ " : "AD", this.x + 30, this.y + 32); }
            ctx.restore();
        }
        update() { if (!isPaused && !isGameOver && gameActive) this.y += this.speed; }
    }

    function spawnBlock() {
        if (!isPaused && !isGameOver && gameActive) {
            let elapsed = (Date.now() - startTime - pausedTimeTotal) / 1000;
            let rand = Math.random();
            let newType = 'white';
            if (elapsed > 20 && rand < 0.2) newType = 'whiteDot';
            else if (rand > 0.82) newType = 'black';
            blocks.push(new Block(newType, moveSpeed));
        }
        setTimeout(spawnBlock, Math.max(160, 680 - (moveSpeed * 95)));
    }

    setInterval(() => { if (!isPaused && !isGameOver && gameActive) moveSpeed += 0.1; }, 1000);

    function update() {
        if (isGameOver || !gameActive) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        if (!isPaused) {
            let elapsed = (Date.now() - startTime - pausedTimeTotal) / 1000;
            document.getElementById('time-display').innerText = `${elapsed.toFixed(1)}s`;
        }
        ctx.beginPath(); ctx.moveTo(0, groundY); ctx.lineTo(canvas.width, groundY); 
        ctx.strokeStyle = '#ff4d4d'; ctx.lineWidth = 4; ctx.stroke();
        particles.forEach((p, i) => { p.update(); p.draw(); if(p.life <= 0) particles.splice(i, 1); });
        for (let i = blocks.length - 1; i >= 0; i--) {
            const b = blocks[i]; b.update(); b.draw();
            if (b.type === 'white' && b.y + b.height >= groundY) { gameOver(); return; }
            if (b.y > canvas.height) blocks.splice(i, 1);
        }
        requestAnimationFrame(update);
    }

    function gameOver() {
        isGameOver = true; playSfx('fail'); bgm.pause();
        let finalTime = (Date.now() - startTime - pausedTimeTotal) / 1000;
        document.getElementById('final-time-val').innerText = `${finalTime.toFixed(1)}s`;
        if (finalTime > parseFloat(bestTime)) localStorage.setItem('bestSurvivalTime', finalTime);
        document.getElementById('game-over-panel').style.display = 'block';
    }

    function handleInput(e) {
        if (!gameActive || isPaused || isGameOver) return;
        const rect = canvas.getBoundingClientRect();
        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        const mouseX = (clientX - rect.left) * scaleX;
        const mouseY = (clientY - rect.top) * scaleY;
        const hitPadding = 20;

        for (let i = blocks.length - 1; i >= 0; i--) {
            const b = blocks[i];
            if (mouseX >= b.x - hitPadding && mouseX <= b.x + b.width + hitPadding && mouseY >= b.y - hitPadding && mouseY <= b.y + b.height + hitPadding) {
                if (b.type === 'white') {
                    playSfx('white');
                    for (let j = 0; j < 12; j++) particles.push(new Particle(b.x+30, b.y+25, '#CCCCCC'));
                    blocks.splice(i, 1);
                } else {
                    showAd();
                    const pColor = b.type === 'black' ? '#333333' : '#CCCCCC';
                    for (let j = 0; j < 12; j++) particles.push(new Particle(b.x+30, b.y+25, pColor));
                    blocks.splice(i, 1);
                }
                break;
            }
        }
    }

    function showAd() {
        isPaused = true; bgm.pause(); pauseStartedAt = Date.now();
        document.getElementById('ad-modal').style.display = 'block';
        const container = document.getElementById('kakao-ad-container');
        container.innerHTML = `<ins class="kakao_ad_area" style="display:none;" data-ad-unit="DAN-tTvpwiRyg3nxCPs1" data-ad-width="320" data-ad-height="50"></ins>`;
        const script = document.createElement('script');
        script.src = "//t1.daumcdn.net/kas/static/ba.min.js";
        script.async = true;
        container.appendChild(script);
    }

    function closeAd() {
        moveSpeed = Math.max(1.8, moveSpeed - 0.4);
        pausedTimeTotal += (Date.now() - pauseStartedAt);
        isPaused = false; if (!isMuted) bgm.play().catch(()=>{});
        document.getElementById('ad-modal').style.display = 'none';
    }

    function startGame() {
        document.getElementById('start-overlay').style.display = 'none';
        gameActive = true; if (audioCtx.state === 'suspended') audioCtx.resume();
        bgm.muted = isMuted; if (!isMuted) bgm.play().catch(()=>{});
        startTime = Date.now(); spawnBlock(); update();
    }

    function toggleMute(e) {
        if(e) e.stopPropagation();
        isMuted = !isMuted;
        localStorage.setItem('gameMuted', isMuted);
        bgm.muted = isMuted;
        if (isMuted) bgm.pause();
        else if (gameActive && !isPaused) bgm.play().catch(() => {});
        document.getElementById('mute-btn').innerText = isMuted ? "ğŸ”‡ Off" : "ğŸµ On";
    }

    canvas.addEventListener('touchstart', (e) => { e.preventDefault(); handleInput(e); }, {passive: false});
    canvas.addEventListener('mousedown', handleInput);
    window.onload = () => { updateLanguage(); document.getElementById('mute-btn').innerText = isMuted ? "ğŸ”‡ Off" : "ğŸµ On"; };
</script>

</body>
</html>
